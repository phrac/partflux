<div class="modal hide" id="buylink-modal">
    {% if user.is_authenticated %}
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><i class="icon-remove"></i></button>
        <h3>Add a new purchase link</h3>
    </div>
    <div class="modal-body">
        <p>Purchase links are links to online retailers. These links assist users in purchasing the parts.
        </p>
        <form id="buylink-form" name="buylink-form" class="form-horizontal" autocomplete="off" method="post">
            {% csrf_token %}

            <div class="control-group">
                <label class="control-label" for="id_url">URL</label>
                <div class="controls">
                    <input type="text" name="url" id="url" />
                    <p>Enter the full URL to a page where part # {{ part.number }} can be purchased.</p>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label" for="id_company">Company Name</label>
                <div class="controls">
                    {{ buylinkform.company }}
                    <p>Enter the name of the company selling the part, <strong>not the manufacturer of the part!</strong></p>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label" for="id_price">Current Price</label>
                <div class="controls">
                    <div class="input-prepend">
                        <span class="add-on">$</span><input name="price" class="span2" id="id_price" size="16" type="text">
                        <p>Enter the price of the item.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <input type="hidden" name="buylink_button" value="1" />
            <button id="save-buylink" type="submit" data-loading-text="Saving..." class="btn btn-inverse">Save Link</button>
            <button id="cancel-buylink" class="btn" data-dismiss="modal">Cancel</button>
        </form>
    </div>

    <script type="text/javascript">
        $('#save-buylink').click(function() {
            $('#save-buylink').button('loading');
        });
    </script>
    <script type="text/javascript">
        $('#cancel-buylink').click(function() {    
            $('#buylink-form').each(function() {this.reset();});
        });
    </script>

    <script type="text/javascript">
        $('#buylink-modal').on('shown', function () {
            $('#id_url').focus();
        })
    </script>
    
    <script type="text/javascript">
        $(document).ready(function() {
                $('#buylink-form').submit(function() { // catch the form's submit event

                $.ajax({ // create an AJAX call...
                    data: $(this).serialize(), // get the form data
                    type: $(this).attr('method'), // GET or POST
                    url: $(this).attr('action'), // the file to call
                    success: function(response) { // on success..
                        $('#buylink-modal').modal('hide');
                        $('#buylink-form').each(function() {
                            this.reset();
                        });
                        $('#buylink-table').hide().html(response).fadeIn("slow"); // update the DIV
                        $.gritter.add({
                            title:	'Purchasing Information Added',
                            text:	'Thanks for contributing to Part Engine!',
                            sticky: false
                            });
                        $('#save-buylink').button('reset');
                    }
                });
                return false;
            });
        });
    </script>

    {% else %}
    {% include 'includes/login_modal.html' %}
    {% endif %}
</div>
