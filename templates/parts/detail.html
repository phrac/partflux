{% extends "base.html" %}

{% load humanize %}
{% load parttags %}
{% load comments %}

{% block title %}
{{ page_title|safe }}
{% endblock %}

{% block meta_description %}{{ part.company.name|safe }} {{ part.number }} : {{ part.description }}{% endblock %}
{% block meta_keywords %}{{ part.company.name|safe }}, {{ part.number }},
{% for x in part.cross_references.all %}
{{ x.number }},
{% endfor %}
{% endblock %}

{% block breadcrumbs %}
<li class="divider">
    <i class="icon-caret-right"></i>
    </li>
    <li><a href="{% url 'parts.views.index' %}">Parts</a></li>
{% endblock %}

{% block no_adsense %}{% endblock %}

{% block css %}
<link href="{{ STATIC_URL }}css/select2.css" rel="stylesheet" />
<link href="{{ STATIC_URL }}css/bootstrap-editable.css" rel="stylesheet">
<link rel="stylesheet" href="{{ STATIC_URL }}css/uniform.css" type="text/css" media="screen" />
{% endblock %}

{% block js %}
<script src="{{ STATIC_URL }}js/bootstrap-editable.min.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $(".company-ta input[type=text]").typeahead({
            items: 5,
            source: function (query, process) {
            $.get('/search/autocomplete?type=company', { q: query }, function (data) {
                process(data)
            })
        }
        });
        $(".category-ta input[type=text]").typeahead({
            items: 10,
            source: function (query, process) {
            $.get('/search/autocomplete?type=category', { q: query }, function (data) {
                process(data)
            })
        }
        });
        $.fn.editable.defaults.mode = 'inline';
        $('#description').editable({
            params: {csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value},
        });
});
</script>
<script type="text/javascript">
    $(document).ready(function() {
            $('#buylink-table').load('/parts/ajax/load_distributors/{{ part.pk }}');
            $('#images-table').load('/parts/ajax/load_images/{{ part.pk }}');
            });
</script>

{% if user.is_staff %}
<!-- load scripts for admin -->
<script type="text/javascript">
    $(document).ready(function() {
            console.log('fire asin');
        $('#asin_search').load('/parts/ajax/asin_search/{{ part.pk }}');
        });
     $(document).ready(function() {

        $(function(){
            $('.asin').click(function(){
                console.log('click');
                $("#id_asin").val($(this).text());
                $("#add-asin").modal('show');
            });
            });
        });

</script>

<script src="{{ STATIC_URL }}js/modal-form.js"></script>
<script src="{{ STATIC_URL }}js/jquery.uniform.js"></script>
<script src="{{ STATIC_URL }}js/select2.min.js"></script>
<script src="{{ STATIC_URL }}js/jquery.validate.js"></script>
<script src="{{ STATIC_URL }}js/unicorn.form_validation.js"></script>
    <script type="text/javascript">
        $('#cancel-attribute').click(function() {    
            $('#attribute-form').each(function() {this.reset();});
            var validator = $("#attribute-form").validate();
            validator.resetForm();
        });
    </script>
    
    <script type="text/javascript">
        $(document).ready(function() {
            $("#cat1").jCombo("/parts/ajax/parent_categories/", { 
                initial_text: "------ Select Category ------", 
                selected_value: "0",
                dataType: "json"
            });
	        $("#cat2").jCombo("/parts/ajax/child_categories/", { 
                initial_text: "------ Select Sub-Category 1------",
                parent: "#cat1",
                selected_value: "0",
                dataType: "json" 
            } );
            $("#cat3").jCombo("/parts/ajax/child_categories/", { 
                initial_text: "------ Select Sub-Category 2------",
                parent: "#cat2",
                selected_value: "0",
                dataType: "json" 
            } );
            $("#cat4").jCombo("/parts/ajax/child_categories/", { 
                initial_text: "------ Select Sub-Category 3------",
                parent: "#cat3",
                selected_value: "0",
                dataType: "json" 
            } );
            $("#cat5").jCombo("/parts/ajax/child_categories/", { 
                initial_text: "------ Select Sub-Category 4------",
                parent: "#cat4",
                selected_value: "0",
                dataType: "json" 
            } );
            $("#cat6").jCombo("/parts/ajax/child_categories/", { 
                initial_text: "------ Select Sub-Category 4------",
                parent: "#cat5",
                selected_value: "0",
                dataType: "json" 
            } );
        });
    </script>
    {% endif %}
{% endblock %}

{% block content %}
<div class="row-fluid" itemscope itemtype="http://data-vocabulary.org/Product">
    <div class="span12">
        {% include 'parts/includes/category.html' %}
        <h3><a itemprop="brand" href="{{ part.company.get_absolute_url }}">{{ part.company|safe }}</a> {{ part.number }}</h3>
        <h4><span id="description" data-name="description" data-placeholder="No Description" data-type="text" data-inputclass="input input-large" data-pk="{{ part.pk }}" data-url="{% url 'parts.ajax.update_description' %}" itemprop="description" >{{ part.description }}</span></h4>

    </div>
</div>
<div class="separator bottom"></div>
<div class="row-fluid">
    
    <div class="span3" data-toggle="modal-gallery" data-target="#modal-gallery" id="gallery-5" data-delegate="#gallery-5">
        <div class="widget widget-heading-simple widget-body-white">
            <div class="widget-body">
                <div class="glyphicons glyphicon-top glyphicon-large table">
                    <i></i>
                    <h4>{{ part.number }} DATA CARD</h4>
                </div>
                <div id="data-card">
                    <table class="table table-condensed">
                        <tr>
                            <th>Part #</th>
                            <td>{{ part.number }}</td>
                        </tr>
                        <tr>
                            <th>Mfg.</th>
                            <td>{{ part.company }}</td>
                        </tr>
                        <tr>
                            <th>Categories</th>
                            <td>
                                {% for c in part.categories.all %}
                                    {{ c }}
                                {% endfor %}
                            </td>
                        </tr>
                        <tr>
                            <th>ASIN</th>
                            <td>{{ part.asin|default:"N/A" }}</td>
                        </tr>
                        <tr>
                            <th>UPC</th>
                            <td>{{ part.upc|default:"N/A" }}</td>
                        </tr>
                        <tr>
                            <th>EAN</th>
                            <td>{{ part.ean|default:"N/A" }}</td>
                        </tr>
                         <tr>
                            <th>Weight</th>
                            <td>{{ part.ean|default:"N/A" }}</td>
                        </tr>
                         <tr>
                            <th>Dimensions</th>
                            <td>{{ part.ean|default:"N/A" }}</td>
                        </tr>
                        <tr>
                            <th>Package Qty</th>
                            <td>{{ part.ean|default:"N/A" }}</td>
                        </tr>
                        <tr>
                            <th>Cross Refs</th>
                            <td>{{ part.cross_references.all|length }}</td>
                        </tr>
                        <tr>
                            <th>Attributes</th>
                            <td>{{ part.attribute_set.all|length }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <p class="separator text-center"><i class="icon-picture icon-3x"></i></p>
        <div class="separator bottom"></div>
        {% include 'parts/includes/image_table.html' %}
        <p class="separator text-center"><i class="icon-bar-chart icon-3x"></i></p>
        <div class="separator bottom"></div>
        {% include 'parts/includes/statistics.html' %}
            

    </div>
    <!-- // Product Gallery END -->
    <div class="span9">
        <div class="row-fluid">
            <div class="span6">
                <!-- Product description -->
                <div class="widget widget-heading-simple widget-body-gray">
                    <div class="widget-head"><h4 class="heading glyphicons notes strong"><i></i>Detailed Information</h4></div>
                    <div class="widget-body">
                        <p><span class="text-primary strong text-uppercase">{{ part.description }}</span> {{ part.detailed_description }}</p>
                    </div>
                    <a href="#attribute-modal" data-toggle="modal" class="hidden-phone btn btn-toggle-code btn-mini btn-primary btn-icon">
                            <i class="icon-plus-sign icon-white"></i> Edit Description
                        </a>
                </div>
                <!-- // Product description END -->
                <div class="widget widget-heading-simple widget-body-default">
                    <div class="widget-head"><h4 class="heading glyphicons warning_sign strong"><i></i>Important note</h4></div>
                    <div class="widget-body"><p class="margin-none">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi erat massa, ultricies sit amet.</p></div>
                </div>
            </div>
            <div class="span6">
                <form class="margin-bottom-none">
                   
                    <!-- Price -->
                    <div class="box-generic">
                        <div class="separator bottom">
                            <span class="text-large pull-right">{{ distributor_skus.count|default:"0" }}</span>
                            <span class="text-large">${{ agg_pricing.avg_price|floatformat:2|default:"N/A" }}</span><br/>
                            <span class="text-faded pull-right">Distributors</span>
                            <span class="text-faded">Average Distributor Price</span>
                        </div>
                        <table class="table table-condensed">
                            <tr>
                                <th>Distributor</th>
                                <th>SKU</th>
                                <th>Price</th>
                            </tr>
                        {% for d in distributor_skus|slice:":3" %}
                        <tr>
                            <td><a href="{{ d.url }}">{{ d.distributor }}</a></td>
                            <td>{{ d.sku }}</td>
                            <td>${{ d.price }}</td>
                        </tr>
                        {% endfor %}
                        </table> 
                        <div class="separator bottom">
                            <a href="#distributors" class="btn btn-icon btn-large glyphicons cart_in btn-success btn-block"><i></i>Show all Distributors</a>
                        </div>
                        <div class="text-right share">
                            <a href="" class="glyphicons standard facebook"><i></i></a> <a href="" class="glyphicons standard twitter"><i></i></a>
                        </div>
                        <div class="separator bottom"></div>
                        <a href="#distributor-sku-modal" data-toggle="modal" class="hidden-phone btn btn-toggle-code btn-mini btn-primary btn-icon">
                            <i class="icon-plus-sign icon-white"></i> Suggest Distributor
                        </a>
                    </div>
                    <!-- // Purchase Options END -->
                    
                </form>
            </div>
        </div>

        <p class="separator text-center"><i class="icon-ellipsis-horizontal icon-3x"></i></p>
        <div class="separator bottom"></div>

        {% if user.is_staff and not part.asin %}
        <div class="widget">
            <div class="widget-head">
                <h4 class="heading glyphicons history"><i></i>Possible ASIN Matches</h4>
            </div>
            <div id="asin_search" class="widget-body list">
                <i class="icon-spinner icon-spin icon-xlarge"></i> Loading Amazon matches ...       
            </div>
            <a href="#attribute-modal" data-toggle="modal" class="hidden-phone btn btn-toggle-code btn-mini btn-primary btn-icon outside">
            </a>
        </div>
        {% endif %}

        <div class="widget">
            <div class="widget-head">
                <h4 class="heading glyphicons history"><i></i>Attributes / Properties</h4>
            </div>
            <div class="widget-body list">
                {% include 'parts/includes/attribute_table.html' %}   
            </div>
            <a href="#attribute-modal" data-toggle="modal" class="hidden-phone btn btn-toggle-code btn-mini btn-primary btn-icon outside">
                <i class="icon-plus-sign icon-white"></i> New Attribute
            </a>
        </div>


        <p class="separator text-center">
            <i class="icon-ellipsis-horizontal icon-3x"></i>
        </p>
        
        <div class="widget">
            <div class="widget-head">
                <h4 class="heading glyphicons random"><i></i>Cross References</h4>
            </div>
            <div class="widget-body list">
                {% include 'parts/includes/xrefs_table.html' %}   
            </div>
        </div>

        <p class="separator text-center" id="distributors">
        <i class="icon-ellipsis-horizontal icon-3x"></i>
        </p>
        <div class="widget">
            <div class="widget-head">
                <h4 class="heading glyphicons credit_card"><i></i>Distributor Information</h4>
            </div>
            <div class="widget-body list">
                <table class="table table-condensed">
                    <tr>
                        <th>Distributor</th>
                        <th>SKU</th>
                        <th>Price</th>
                        <th>Coupons</th>
                        <th>Updated</th>
                        <th>xpath</th>
                    </tr>
                    {% for d in distributor_skus %}
                    <tr>
                        <td><a href="{{ d.url }}">{{ d.distributor }}</a></td>
                        <td>{{ d.sku }}</td>
                        <td class="text-primary strong">${{ d.price }}</td>
                        <td>{{ d.coupons|default:"None" }}</td>
                        <td>{{ d.updated|naturaltime }}</td>
                        <td>{{ d.update_xpath_price }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </a>
    </div>
    <p class="separator text-center">
        <i class="icon-ellipsis-horizontal icon-3x"></i>

        <div class="widget">
            <div class="widget-head">
                <h4 class="heading glyphicons random"><i></i>Comments</h4>
            </div>
            <div class="widget-body">
                {% include 'includes/disqus.html' %}   
            </div>
        </div>
    </div>
</div>
<div class="separator bottom"></div>
<!-- // Product details END -->
        {% csrf_token %}
        {% if user.is_staff %}
        {% include 'parts/includes/modals/attribute_modal.html' %} 
        {% include 'parts/includes/modals/image_modal.html' %}
        {% include 'parts/includes/modals/xref_modal.html' %}
        {% include 'parts/includes/modals/company_modal.html' %}
        {% include 'parts/includes/modals/add_favorite-modal.html' %}
        {% include 'parts/includes/modals/asin_modal.html' %}
        {% include 'parts/includes/modals/category_modal.html' %}
        {% include 'distributors/modals/new_sku.html' %}
        {% endif %}

{% endblock %}
