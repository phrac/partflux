{% extends "base/base_MAIN.html" %}

{% load humanize %}
{% load parttags %}
{% load comments %}

{% block title %}
{{ page_title|safe }}
{% endblock %}

{% block meta_description %}{{ part.number }} by {{ part.company.name|safe }} : {{ part.description }}{% endblock %}

{% block parts_active %}active open{% endblock %}

{% block no_adsense %}{% endblock %}
{% block head %}
<!-- search typeahead -->
<script type="text/javascript">
    $(document).ready(function() {
        $(".company-ta input[type=text]").typeahead({
            items: 5,
            source: function (query, process) {
            $.get('/search/autocomplete?type=company', { q: query }, function (data) {
                process(data)
            })
        }
    });
});
</script>
{% endblock %}
{% block content %}
<div class="row-fluid" itemscope itemtype="http://data-vocabulary.org/Product">
    <div class="span12">

            <h2><span itemprop="name">{{ part.number }}</span> by <a itemprop="brand" href="{{ part.company.get_absolute_url }}">{{ part.company|safe }}</a></h2>
            <h4><span itemprop="description">{{ part.description }}</span></h4>
            {% include 'includes/adsense_728x90.html' %}

    </div>
</div>

<div class="row-fluid">
    <div class="span12">
        <!-- buylinks -->
        <div class="page-header section-header">
        <h4><i class="icon-shopping-cart"></i> Distributors
        {% if user.is_staff %}
            <a title="New Xref" href="#buylink-modal" data-toggle="modal"><i class="pull-right icon-plus-sign icon-white"></i></a>
        {% endif %}
        </h4>
        </div>
        
        <div id="buylink-table">
            {% include 'parts/includes/buylink_table.html' %}
        </div>
        
        
        <!-- attributes -->
        <div class="page-header section-header">
        <h4><i class="icon-list"></i> Attributes
        {% if user.is_staff %}
            <a title="New Attribute" href="#attribute-modal" data-toggle="modal"><i class="pull-right icon-plus-sign icon-white"></i></a>
        {% endif %}    
        </h4>
        </div>
        <div id="attribute-table">
            {% include 'parts/includes/attribute_table.html' %}
        </div>

        <!-- cross refs -->
        <div class="page-header section-header">
        <h4><i class="icon-random"></i> Cross References
        {% if user.is_staff %}
            <a title="New Xref" href="#add-xref" data-toggle="modal"><i class="pull-right icon-plus-sign icon-white"></i></a>
        {% endif %}
        </h4>
        </div>
        <div id="xrefs-table">
            {% include 'parts/includes/xrefs_table.html' %}
        </div>
        
        <!-- images widget -->
        <div class="page-header section-header">
        <h4><i class="icon-picture"></i> Part Images
        {% if user.is_staff %}
            <a title="New Xref" href="#image-modal" data-toggle="modal"><i class="pull-right icon-plus-sign icon-white"></i></a>
        {% endif %}
        </h4>
        </div>
        {% include 'parts/includes/image_table.html' %}

        
        <!-- similar parts -->
        <div class="page-header section-header">
        <h4><i class="icon-th"></i> Similar Parts</h4>
        </div>
        {% if mlt %}
        <table class="table table-striped table-condensed">
            <tbody>
                {% for p in mlt %}
                <tr>
                    <td>
                        <a href="{{ p.object.get_absolute_url }}">{{ p.object.number }}</a>
                    </td>
                    <td>
                        {{ p.object.description|truncatechars:120 }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="widget-content">
            <div class="alert alert-error">No similar parts found</div>
        </div>
        {% endif %}

        <!-- comments widget -->
        {% include 'includes/disqus.html' %}

        
        
        {% if user.is_staff %}
        <script src="{{ STATIC_URL }}js/modal-form.js"></script>
        <link rel="stylesheet" href="{{ STATIC_URL }}css/uniform.css" type="text/css" media="screen" />
        <script src="{{ STATIC_URL }}js/jquery.uniform.js"></script>
        <link href="{{ STATIC_URL }}css/select2.css" rel="stylesheet" />
        <script src="http://ivaynberg.github.com/select2/select2-master/select2.js"></script>
        <script src="{{ STATIC_URL }}js/jquery.validate.js"></script>
        <script src="{{ STATIC_URL }}js/unicorn.form_validation.js"></script>

        {% csrf_token %}
        {% include 'parts/includes/modals/attribute_modal.html' %} 
        {% include 'parts/includes/modals/image_modal.html' %}
        {% include 'parts/includes/modals/xref_modal.html' %}
        {% include 'parts/includes/modals/buylink_modal.html' %}
        {% include 'parts/includes/modals/company_modal.html' %}
        {% include 'parts/includes/modals/flag_modal.html' %}
        {% include 'parts/includes/modals/add_favorite-modal.html' %}
        {% include 'parts/includes/modals/delete_image_modal.html' %}
        {% endif %}
    </div>
</div>

{% endblock %}

{% block rightbar %}
<div class="module-top">
    <i class="icon-money"></i> Distributor Pricing Overview
</div>
<div class="module">
    <table class="table">
        <tr>
            <td>Average Price</td>
            <td>${{ agg_pricing.avg_price|default:"0.00" }}</td>
        </tr>
        <tr>
            <td><strong>Low Price</strong></td>
            <td><strong>${{ agg_pricing.min_price|default:"0.00" }}</strong></td>
        </tr>
        <tr>
            <td>High Price</td>
            <td>${{ agg_pricing.max_price|default:"0.00" }}</td>
        </tr>
    </table>
</div>
{% endblock %}
